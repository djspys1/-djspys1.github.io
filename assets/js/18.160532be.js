(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{338:function(e,a,t){"use strict";t.r(a);var s=t(33),l=Object(s.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"bbr加速"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bbr加速"}},[e._v("#")]),e._v(" bbr加速")]),e._v(" "),t("p",[e._v("bbr是google的一套算法，用于实现tcp加速，本文记录如何在centos7中使用bbr")]),e._v(" "),t("p",[e._v("首先查看一下当前服务器的kernel有没有按照，版本对不对：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("uname -r\n")])])]),t("p",[e._v("大概会显示这么一个玩意")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("3.10.0-514.2.2.el7.x86_64\n")])])]),t("p",[e._v("安装 ELRepo repo:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org\nsudo rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm\n")])])]),t("p",[e._v("通过刚刚安装的elrepo repo安装4.9.0以上的kernel")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo yum --enablerepo=elrepo-kernel install kernel-ml -y\n")])])]),t("p",[e._v("确认下刚刚安装的")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("rpm -qa | grep kernel\n")])])]),t("p",[e._v("显示的结果大概如下，不一定完全一样，但应该有一个4.9.0以上的kernel")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kernel-ml-4.9.0-1.el7.elrepo.x86_64\nkernel-3.10.0-514.el7.x86_64\nkernel-tools-libs-3.10.0-514.2.2.el7.x86_64\nkernel-tools-3.10.0-514.2.2.el7.x86_64\nkernel-3.10.0-514.2.2.el7.x86_64\n")])])]),t("p",[e._v("通过设置grub2的默认启动项来启用这个4.9.0以上的kernel")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo egrep ^menuentry /etc/grub2.cfg | cut -f 2 -d \\'\n")])])]),t("p",[e._v("结果大概是这样的")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("CentOS Linux 7 Rescue a0cbf86a6ef1416a8812657bb4f2b860 (4.9.0-1.el7.elrepo.x86_64)\nCentOS Linux (4.9.0-1.el7.elrepo.x86_64) 7 (Core)\nCentOS Linux (3.10.0-514.2.2.el7.x86_64) 7 (Core)\nCentOS Linux (3.10.0-514.el7.x86_64) 7 (Core)\nCentOS Linux (0-rescue-bf94f46c6bd04792a6a42c91bae645f7) 7 (Core)\n")])])]),t("p",[e._v("从0开始数，第一行是0，第二行是1，这里是第二行的，下面的命令用1")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo grub2-set-default 1\n")])])]),t("p",[e._v("重启服务器")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo shutdown -r now\n")])])]),t("p",[e._v("再次查看kernel版本")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("uname -r\n")])])]),t("p",[e._v("没意外的话已经切换好了")]),e._v(" "),t("p",[e._v("修改sysctl配置来启用bbr算法：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("echo 'net.core.default_qdisc=fq' | sudo tee -a /etc/sysctl.conf\necho 'net.ipv4.tcp_congestion_control=bbr' | sudo tee -a /etc/sysctl.conf\nsudo sysctl -p\n")])])]),t("p",[e._v("确认已开启bbr")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo sysctl net.ipv4.tcp_available_congestion_control\n")])])]),t("p",[e._v("输出为：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("net.ipv4.tcp_available_congestion_control = bbr cubic reno\n")])])]),t("p",[e._v("再次验证")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo sysctl -n net.ipv4.tcp_congestion_control\n")])])]),t("p",[e._v("输出为：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("bbr\n")])])]),t("p",[e._v("最后检查kernel module有没有加载")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("lsmod | grep bbr\n")])])]),t("p",[e._v("结果类似是这样的")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("tcp_bbr                16384  0\n")])])]),t("p",[e._v("接下来可以随心所欲的测试，比如下载个文件啥的，就不写了")])])}),[],!1,null,null,null);a.default=l.exports}}]);